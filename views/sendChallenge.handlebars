{{> challenge_nav }}
<main>
   <div>
      {{!--<h1>Rise-to-the-Challenge</h1>--}}
   </div>
   <div class="z-depth-2 cont">
      <h5>Issue your Challenge</h5>
      <div class="collection Form">
         <br>
         <div class="row">
            <form class="col s12" id="challengeIssue">
               <div class="row">
                  <div class="input-field col s6">
                     <input id="challenge_autocomplete" placeholder="Ice bucket Challenge" name="challenge_name" type="text" class="autocomplete validate">
                     <label class="active" for="challenge_autocomplete">Name of the Challenge:</label>
                  </div>
               </div>
               <div class="row">
                  <div class="input-field col s6">
                     <input id="recepient_autocomplete" placeholder="Placeholder" name="challenged_name" type="text" class="autocomplete validate" multiple>
                     <label class="active" for="name_autocomplete">Name of the Person you wish to challenge:</label>
                  </div>
                  <div class="input-field col s6">
                     <input id="email_autocomplete" placeholder="example@gmail.com" name="challenged" type="text" class="autocomplete validate" multiple>
                     <label class="active" for="email_autocomplete">Their Email:</label>
                  </div>
               </div>
               <div class="row">
                  <div class="input-field col s12">
                     <textarea id="rules" name="rules" class="materialize-textarea"></textarea>
                     <label class="active" for="rules">Rules:</label>
                  </div>
               </div>
               <div class="col s12">
                  <div class="input-field">
                     <input id="proofLink" placeholder="link your proof video or image here" name="postLink" type="url" class="validate">
                     <label class="active" for="email" data-error="wrong" data-success="right">Proof: Image or Video</label>
                  </div>
               </div>
               <!--<a href="./dashboard.html">-->
               <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                  <!--<i class="material-icons right">send</i>-->
               </button>
            </form>
            <!--</a>-->
         </div>
</main>
<script type="text/javascript">
   (function($) {
      const template = JSON.parse(`{{json template}}`);
      const user = JSON.parse(`{{json user}}`);

      // template
      const template_name = new Array(),
         template_rule = {};

      template.forEach((elem) => {
         template_name.push(elem.name);
         template_rule[elem.name] = elem.rule; // this is autofilled
      });

      $("#challenge_autocomplete").autocomplete({
         source: template_name,
         limit: 20, // The max amount of results that can be shown at once. Default: Infinity.
         onAutocomplete: function(val) {
            // Callback function when value is autcompleted.
         },
         minLength: 1, // The minimum length of the input for the autocomplete to start. Default: 1.
      });

      $("#challenge_autocomplete").blur(function() {
         const paired_rule = template_rule[$(this).val()];
         console.log(paired_rule);
         !!paired_rule ? $("#rules").val(paired_rule).prop("placeholder", "").next("label").text("") : console.log("...");
      });

      // user
      const user_name = new Array(),
         user_email = {};

      user.forEach((elem) => {
         user_name.push(elem.name);
         user_email[elem.name] = elem.email;
      });

      $("#recepient_autocomplete").autocomplete({
         source: user_name,
         limit: 20, 
         onAutocomplete: function(val) {
         },
         minLength: 1
      });

      $("#recepient_autocomplete").blur(function() {
         const paired_email = user_email[$(this).val()];
         console.log(paired_email);
         !!paired_email ? $("#email_autocomplete").val(paired_email).prop("placeholder", "") : console.log("...");
      });

      console.log(template);
   }(jQuery));
</script>
